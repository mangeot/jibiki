<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Papillon</title>
</head>

<body>

<div id="ApiContent" lang="en" xml:lang="en">
<h1 style="text-align:center">jibiki REST Application Programming Interface</h1>
<h2>Summary</h2>

<h3>List of available dictionaries</h3>

<table class="api">
 <tbody>
    <tr><td>URL</td><td><a href="api/">api/</a></td></tr>
    <tr><td>Method</td><td>GET</td></tr>
    <tr><td>Returns</td><td>200 OK &amp; XML (list of dictionaries metadata)</td></tr>
 </tbody>
</table>

<h3>Description of a dictionary</h3>

<table class="api">
 <tbody>
    <tr><td>URL</td><td>api/[dictionary]/</td></tr>
    <tr><td>Method</td><td>GET</td></tr>
     <tr><td rowspan="2">Returns</td><td>200 OK &amp; XML (dictionary metadata)</td></tr>
    <tr><td>404 Not Found</td></tr>
 </tbody>
</table>

<h3>Description of a volume</h3>

<table class="api">
 <tbody>
    <tr><td>URL</td><td>api/[dictionary]/[lang]/</td></tr>
    <tr><td>Method</td><td>GET</td></tr>
    <tr><td rowspan="2">Returns</td><td>200 OK &amp; XML (volume metadata)</td></tr>
    <tr><td>404 Not Found</td></tr>
 </tbody>
</table>

<h3>Requesting an entry</h3>

<table class="api">
 <tbody>
    <tr><td>URL</td><td>api/[dictionary]/[lang]/[contributionId]</td></tr>
    <tr><td>Method</td><td >GET</td></tr>
    <tr><td rowspan="2">Returns</td><td >200 OK &amp; XML (entry)</td></tr>
    <tr><td>404 Not Found</td></tr>
 </tbody>
</table>

<p>Example of query: <a href="api/FeM/fra/fra.abandonner.8814938.c">api/FeM/fra/fra.abandonner.8814938.c</a></p>
<p>Answer:</p>
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;volume name="FeM_fra" source-language="fra" target-languages="eng msa" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation=" http://www-clips.imag.fr/geta/services/dml/fem.xsd">
&lt;d:contribution 
	d:contribid="fra.abandonner.8814938.c" 
	d:originalcontribid="" 
	xmlns:d="http://www-clips.imag.fr/geta/services/dml" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://www-clips.imag.fr/geta/services/dml  
	http://www-clips.imag.fr/geta/services/dml/dml.xsd">
	&lt;d:metadata>
		&lt;d:author>automatic&lt;/d:author>&lt;
		&lt;d:creation-date>2009/05/07 13:59:57&lt;/d:creation-date>
	...	
	&lt;d:data>
		&lt;entry id="fra.abandonner.8814938.e">
			&lt;headword>abandonner&lt;/headword>&lt;hom/>
			&lt;prnc>aban-done-&lt;/prnc>
			&lt;aux/>
			&lt;body>
				&lt;sense-list>
					&lt;sense>
					&lt;pos-list>v.tr.&lt;/pos-list>
					...
	&lt;/d:data>
&lt;/d:contribution>
&lt;/volume>
</pre>


<h3>Modifying an entire entry</h3>

<table class="api">
 <tbody>
    <tr><td>URL</td><td>api/[dictionary]/[lang]/[contributionId]</td></tr>
    <tr><td>Method</td><td>PUT</td></tr>
    <tr><td rowspan="3">Returns</td><td>201 Created &amp; XML (entry)</td></tr>
    <tr><td>401 Unauthorized</td></tr>
    <tr><td>404 Not Found</td></tr>
 </tbody>
</table>

<p>The data to be sent with the PUT command is the XML of the contribution (entry + metadata).</p>
<p>Note: the user has to be <a href="#Authentication">logged</a> and in the specialist group.</p>

<h3>Modifying part of an entry</h3>

<table class="api">
    <tbody>
        <tr><td>URL</td><td>api/[dictionary]/[lang]/[contributionId]/[string]</td></tr>
        <tr><td>Method</td><td>PUT</td></tr>
        <tr><td rowspan="3">Returns</td><td>201 Created &amp; XML (entry)</td></tr>
        <tr><td>401 Unauthorized</td></tr>
        <tr><td>404 Not Found</td></tr>
    </tbody>
</table>

<p>The data to be sent with the PUT command is the xpath of the element or attribute to be modified.<br/>
[string] is the new value.</p>
<p>Note: the user has to be <a href="#Authentication">logged</a>.</p>

<h3>Creating an entry</h3>

<table class="api">
 <tbody>
    <tr><td>URL</td><td>api/[dictionary]/[lang]/[contributionId]</td></tr>
    <tr><td>Method</td><td>POST</td></tr>
    <tr><td rowspan="2">Returns</td><td>201 Created &amp; XML (entry)</td></tr>
    <tr><td>401 Unauthorized</td></tr>
 </tbody>
</table>

<p>The data to be sent with the PUT command is the XML of the contribution (entry + metadata).</p>
<p>Note: the user has to be <a href="#Authentication">logged</a> and in the validator group.</p>

<h3>Deleting an entry</h3>

<table class="api">
 <tbody>
    <tr><td>URL</td><td>api/[dictionary]/[lang]/[contributionId]</td></tr>
    <tr><td>Method</td><td>DELETE</td></tr>
    <tr><td rowspan="3">Returns</td><td>204 No Content &amp; XML (entry)</td></tr>
    <tr><td>401 Unauthorized</td></tr>
    <tr><td>404 Not Found</td></tr>
 </tbody>
</table>

<p>Note: the user has to be <a href="#Authentication">logged</a> and in the admin group.</p>

<h3>Querying entries</h3>

<table class="api">
 <tbody>
    <tr><td>URL</td><td colspan="2">api/[dictionary]/[lang]/[criteria]/[string]</td></tr>
    <tr><td>URL</td><td colspan="2">api/[dictionary]/[lang]/[criteria]/[string]/[key]</td></tr>
    <tr><td>Method</td><td colspan="2">GET</td></tr>
    <tr><td rowspan="3">Querystring</td><td>strategy=</td><td>strategy</td></tr>
    <tr><td>count=</td><td>count</td></tr>
    <tr><td>startIndex=</td><td>startIndex</td></tr>
    <tr><td rowspan="2">Returns</td><td colspan="2">200 OK &amp; XML (entry handle, key value or full XML)</td></tr>
    <tr><td colspan="2">404 Not Found</td></tr>
 </tbody>
</table>

<p>The searches with the [key] part give the value of the key for the corresponding entries.
For example, searching an entry with <i>api/*/eng/cdm-headword/trial/cdm-pos</i> will give a list of 
parts-of-speech for the "trial" entry.</p>

<p>Several keys can be used at once. They have to be separated with the "|" pipe symbol.
For example, searching an entry with <i>api/*/jpn/cdm-headword|cdm-reading/ぜんとう/</i> will give a list of
handles for entries with headwords or readings matching "ぜんとう".</p>

<p>It is possible to query all the dictionaries by putting a <b>*</b> instead of the name of the dictionary.
It is also possible to do the same for the [lang] and [key] part of the URL.</p>

<p>Several strings can be queried at once. They have to be separated with the "|" pipe symbol.
For example, searching an entry with <i>api/*/eng/cdm-headword/trial|essay/</i> will give a list of
handles for entries with headwords matching "trial" or "essay".</p>

<p>The <b>handle</b> criteria is special as it does not give a list of entry handles but the full entry XML
 content.</p>

<p>Example of query: <a href="api/FeM/fra/cdm-headword/abandon?strategy=EQUAL">api/FeM/fra/cdm-headword/abandon?strategy=EQUAL</a></p>
<p>Answer:</p>
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;entry-list xmlns="http://www-clips.imag.fr/geta/services/dml">
	&lt;entry dictionary="FeM" lang="fra"&gt;
		&lt;criteria value='cdm-headword'&gt;abandon&lt;/criteria&gt;
		&lt;handle&gt;8814938&lt;/handle&gt;
	&lt;/entry&gt;
&lt;/entry-list&gt;
</pre>

<p>Example of query: <a href="api/FeM/fra/cdm-headword/abandonner/cdm-pos">api/FeM/fra/cdm-headword/abandonner/cdm-pos</a></p>
<p>Answer:</p>
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;entry-list xmlns="http://www-clips.imag.fr/geta/services/dml">
	&lt;entry dictionary="FeM" lang="fra"&gt;
		&lt;criteria value='cdm-headword'&gt;abandonner&lt;/criteria&gt;
		&lt;handle&gt;8814938&lt;/handle&gt;
		&lt;key value='cdm-pos'&gt;v.t.&lt;/key&gt;
	&lt;/entry&gt;
&lt;/entry-list&gt;
</pre>

<p>Example of query: <a href="api/FeM/fra/handle/8814938">api/FeM/fra/handle/8814938</a></p>
<p>Answer:</p>
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;volume name="FeM_fra" source-language="fra" target-languages="eng msa" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation=" http://www-clips.imag.fr/geta/services/dml/fem.xsd">
&lt;d:contribution 
	d:contribid="fra.abandonner.8814938.c" 
	d:originalcontribid="" 
	xmlns:d="http://www-clips.imag.fr/geta/services/dml" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://www-clips.imag.fr/geta/services/dml  
	http://www-clips.imag.fr/geta/services/dml/dml.xsd">
	&lt;d:metadata>
		&lt;d:author>automatic&lt;/d:author>&lt;
		&lt;d:creation-date>2009/05/07 13:59:57&lt;/d:creation-date>
	...	
	&lt;d:data>
		&lt;entry id="fra.abandonner.8814938.e">
			&lt;headword>abandonner&lt;/headword>&lt;hom/>
			&lt;prnc>aban-done-&lt;/prnc>
			&lt;aux/>
			&lt;body>
				&lt;sense-list>
					&lt;sense>
					&lt;pos-list>v.tr.&lt;/pos-list>
					...
	&lt;/d:data>
&lt;/d:contribution>
&lt;/volume>
</pre>

<p>Criteria only are one of the following:</p>

<table class="api">
 <tbody>
    <tr><td>handle</td><td>unique entry handle specific to the server database</td></tr>
    <tr><td>previous</td><td>previous entry following the volume lexicographic order</td></tr>
    <tr><td>next</td><td>previous entry following the volume lexicographic order</td></tr>
 </tbody>
</table>

<p>For the above criteria, the string must be an entry handle.</p>

<p>Criteria and keys are one of the following:</p>

<table class="api">
 <tbody>
    <tr><td>cdm-entry-id</td><td>entry id</td></tr>
    <tr><td>cdm-headword</td><td>entry headword</td></tr>
    <tr><td>cdm-headword-variant</td><td>entry headword variant</td></tr>
    <tr><td>cdm-reading</td><td>entry headword reading (ex: japanese kana)</td></tr>
    <tr><td>cdm-writing</td><td>entry headword transcription (ex: pinyin for Chinese)</td></tr>
    <tr><td>cdm-pronunciation</td><td>entry headword pronunciation (Usually in IPA but it depends on the resource)</td></tr>
    <tr><td>cdm-pos</td><td>entry part-of-speech (can be "n", "noun", etc. It depends on the resource)</td></tr>
    <tr><td>cdm-translation</td><td>entry headword translation in another language</td></tr>
    <tr><td>cdm-example</td><td>entry examples</td></tr>
    <tr><td>cdm-idiom</td><td>entry idioms</td></tr>
    <tr><td>cdm-contribution-id</td><td>contribution id</td></tr>
    <tr><td>cdm-contribution-author</td><td>contribution author</td></tr>
    <tr><td>cdm-contribution-creation-date</td><td>contribution creation date</td></tr>
    <tr><td>cdm-contribution-finition-date</td><td>contribution finition date</td></tr>
    <tr><td>cdm-contribution-status</td><td>contribution status</td></tr>
 </tbody>
</table>

<p>Note: criteria and keys depend on the resource. A criteria or a key might not be available for one specific resource.
Other criteria and keys not in the list may exist only for one specific resource.</p>

<p>cdm stands for Common Dictionary Markup</p>

<p>Keys only are one of the following:</p>

<table class="api">
 <tbody>
    <tr><td>entries</td><td>XML code of the 100 first entries satisfying the criteria</td></tr>
    <tr><td>pivax</td><td>UNL translations of a word via axemes and axies</td></tr>
 </tbody>
</table>


<p>Strategy is one of the following:</p>

<table class="api">
 <tbody>
    <tr><td>EQUAL</td><td>indexed search</td></tr>
    <tr><td>CASE_SENSITIVE_STARTS_WITH</td><td>indexed search</td></tr>
    <tr><td>CASE_SENSITIVE_ENDS_WITH</td><td>sequential search</td></tr>
    <tr><td>CASE_SENSITIVE_CONTAINS</td><td>sequential search</td></tr>
    <tr><td>CASE_INSENSITIVE_EQUAL</td><td>indexed search</td></tr>
    <tr><td>CASE_INSENSITIVE_STARTS_WITH</td><td>indexed search</td></tr>
    <tr><td>CASE_INSENSITIVE_ENDS_WITH</td><td>sequential search</td></tr>
    <tr><td>CASE_INSENSITIVE_CONTAINS</td><td>sequential search</td></tr>
    <tr><td>NOT_EQUAL</td><td>indexed search</td></tr>
    <tr><td>GREATER_THAN</td><td>indexed search</td></tr>
    <tr><td>GREATER_THAN_OR_EQUAL</td><td>indexed search</td></tr>
    <tr><td>LESS_THAN</td><td>indexed search</td></tr>
    <tr><td>LESS_THAN_OR_EQUAL</td><td>indexed search</td></tr>
 </tbody>
</table>

<p>Default strategy is <code>CASE_INSENSITIVE_STARTS_WITH</code></p>

<ul>
	<li>All the answers are in XML and encoded in UTF-8.</li>
	<li><em>lang</em> is the ISO 639-2/T 3 letter code of the language (eg: 'eng' for English,'esp' for Spanish,'fra' for French, etc.)</li>
	<li>All parameters are case sensitive (dictionary, contributionId, string, etc.)</li>
</ul>
 
 <h3>Querying entries using link (for pivax data)</h3>

<table class="api">
 <tbody>
    <tr><td>URL</td><td colspan="2">api/[dictionary]/[lang]/link/[headword]</td></tr>
    <tr><td>Method</td><td colspan="2">GET</td></tr>
    <tr><td rowspan="2">Returns</td><td colspan="2">200 OK &amp; XML (entryId, headword)</td></tr>
    <tr><td colspan="2">404 Not Found</td></tr>
 </tbody>
</table>

<p>Example of query: <a href="api/CommonUNLDict/fra/link/manger">api/CommonUNLDict/fra/link/manger</a></p>
<p>Answer:</p>
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;entry-list>
	&lt;entry dictionary="CommonUNLDict" lang="eng">
		&lt;entryId>eng.eat.v&lt;/entryId>
		&lt;headword>eat&lt;/headword>
	&lt;/entry>
	&lt;entry dictionary="CommonUNLDict" lang="fra">
		&lt;entryId>fra.manger.v&lt;/entryId>
		&lt;headword>manger&lt;/headword>
	&lt;/entry>
		&lt;entry dictionary="CommonUNLDict" lang="unl">
		&lt;entryId>eat(icl>consume>do,agt>living_thing,obj>concrete_thing,ins>thing)&lt;/entryId>
		&lt;headword>eat&lt;/headword>
	&lt;/entry>
&lt;/entry-list>
</pre>

<h3 id="Authentication">Authentication methods</h3>
<p>Authentication method is one of the following:</p>

<table class="api">
    <tbody>
        <tr><td>BasicAuth</td><td>login and password are encoded in base 64 and sent to the server in the request header.
        This method is not secure because the encryption method is easy to decrypt.</td></tr>
        <tr><td>Authentication cookie</td><td>cookies are sent to the server in the request header. In order to ask for an authentication cookie, please visit the <a href="LoginUser.po">login page</a>.</td></tr>
        <tr><td rowspan="3">Querystring</td><td>login=login</td></tr>
        <tr><td>password=password</td></tr>
        <tr><td>This method is not secure at all : login and password are sent in cleartext.
            They will even be registered on the web server logs!</td></tr>
    </tbody>
</table>


<h2>Misc</h2>
<p>If you need more help, send an email to
<a href="mailto:mathieu.mangeotATimag.fr?subject=jibikiServer&amp;body=replace&nbsp;AT&nbsp;by&nbsp;@&nbsp;in&nbsp;the&nbsp;email&nbsp;address">Mathieu Mangeot</a>.</p>
</div>
</body>
</html>
